# 일산골프모임 - Synology Container Manager에서 프로젝트로 불러와 빌드·실행
#
# DB: MariaDB (NAS에 준비된 DB 또는 phpMyAdmin으로 만든 DB 사용)
# .env 에 DATABASE_URL, GOLF_PASSWORD, (선택) UPLOAD_DIR 설정 후 사용
#
# 볼륨: golf-uploads → /app/public/uploads (갤러리·스코어카드 사진)

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: golf-app:latest
    container_name: golf-app
    restart: unless-stopped
    ports:
      # 호스트:컨테이너. 3000 포트 충돌 시 3001 등으로 변경
      - "3001:3000"
    env_file:
      - .env
    environment:
      # DB는 .env의 DATABASE_URL 사용 (MariaDB URL)
      # 사진 업로드 경로 (고정)
      UPLOAD_DIR: "/app/public/uploads"
    volumes:
      # 업로드 사진 저장 (NAS 경로로 바꿀 수 있음)
      - golf-uploads:/app/public/uploads
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  golf-uploads: # /app/public/uploads 매핑 (사진 유지)
