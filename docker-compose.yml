# 일산골프모임 - Synology Container Manager에서 프로젝트로 불러와 빌드·실행
#
# DB: MariaDB (NAS에 준비된 DB 또는 phpMyAdmin으로 만든 DB 사용)
# .env 에 DATABASE_URL, GOLF_PASSWORD 설정 후 사용
#
# 사진 업로드: 프로젝트 폴더 안 uploads/ 에 저장 (NAS File Station에서 확인 가능)

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: golf-app:latest
    container_name: golf-app
    restart: unless-stopped
    ports:
      # 호스트:컨테이너. 3000 포트 충돌 시 3001 등으로 변경
      - "3001:3000"
    env_file:
      - .env
    environment:
      # DB는 .env의 DATABASE_URL 사용 (MariaDB URL)
      UPLOAD_DIR: "/app/public/uploads"
    volumes:
      # 프로젝트 폴더의 uploads → 컨테이너 업로드 경로 (사진이 여기 남음)
      - ./uploads:/app/public/uploads
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

